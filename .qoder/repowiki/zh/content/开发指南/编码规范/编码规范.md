# 编码规范

<cite>
**本文档中引用的文件**  
- [analysis_options.yaml](file://flutter_app/analysis_options.yaml)
- [tsconfig.json](file://backend/tsconfig.json)
- [tsconfig.json](file://home/user/nian/admin-web/tsconfig.json)
- [tsconfig.node.json](file://home/user/nian/admin-web/tsconfig.node.json)
- [FLUTTER_DEVELOPMENT_GUIDE.md](file://FLUTTER_DEVELOPMENT_GUIDE.md)
- [package.json](file://backend/package.json)
- [package.json](file://home/user/nian/admin-web/package.json)
- [main.dart](file://flutter_app/lib/main.dart)
- [index.ts](file://backend/src/index.ts)
- [App.tsx](file://home/user/nian/admin-web/src/App.tsx)
- [jest.config.js](file://backend/jest.config.js)
</cite>

## 目录
1. [简介](#简介)
2. [命名约定](#命名约定)
3. [代码格式化规则](#代码格式化规则)
4. [文件组织与模块导出](#文件组织与模块导出)
5. [Dart静态分析规则](#dart静态分析规则)
6. [TypeScript编译选项解析](#typescript编译选项解析)
7. [前后端代码风格一致性](#前后端代码风格一致性)
8. [最佳实践与反模式](#最佳实践与反模式)
9. [结论](#结论)

## 简介
本规范文档旨在统一项目中TypeScript和Dart语言的编码标准，确保前后端代码风格一致、可维护性强。文档涵盖命名约定、代码格式化、文件组织、静态分析配置等核心方面，并结合项目实际配置文件进行详细说明。

**Section sources**
- [FLUTTER_DEVELOPMENT_GUIDE.md](file://FLUTTER_DEVELOPMENT_GUIDE.md#L1-L242)

## 命名约定

### Dart命名规范
项目遵循Dart社区标准命名约定：
- **文件名**：使用snake_case（如`user_model.dart`）
- **类名**：使用PascalCase（如`UserModel`）
- **变量与方法**：使用camelCase（如`getUserById`）
- **常量**：使用camelCase或UPPER_CASE（如`apiBaseUrl`）
- **私有成员**：以下划线开头（如`_privateMethod`）

### TypeScript命名规范
TypeScript代码遵循一致的命名约定：
- **文件名**：使用camelCase或kebab-case（如`authController.ts`或`auth-controller.ts`）
- **类与接口**：使用PascalCase（如`AuthController`）
- **变量与函数**：使用camelCase（如`getUserData`）
- **常量**：使用UPPER_CASE（如`API_BASE_URL`）
- **私有成员**：以下划线开头（如`_privateMethod`）

**Section sources**
- [FLUTTER_DEVELOPMENT_GUIDE.md](file://FLUTTER_DEVELOPMENT_GUIDE.md#L5-L11)
- [main.dart](file://flutter_app/lib/main.dart#L1-L105)
- [index.ts](file://backend/src/index.ts#L1-L85)
- [App.tsx](file://home/user/nian/admin-web/src/App.tsx#L1-L154)

## 代码格式化规则

### Dart格式化
项目使用Dart官方格式化工具`dart format`进行代码格式化，确保代码风格统一。开发者应在提交代码前运行`dart format .`命令。

### TypeScript格式化
虽然项目未明确配置Prettier，但通过TypeScript编译器和ESLint确保代码质量。建议使用默认的TypeScript格式化规则，保持代码整洁。

**Section sources**
- [FLUTTER_DEVELOPMENT_GUIDE.md](file://FLUTTER_DEVELOPMENT_GUIDE.md#L13-L242)
- [backend/package.json](file://backend/package.json#L1-L55)
- [home/user/nian/admin-web/package.json](file://home/user/nian/admin-web/package.json#L1-L65)

## 文件组织与模块导出

### Dart项目结构
Dart项目采用标准的分层架构：
- `lib/core`：核心功能（DI、网络、存储）
- `lib/data`：数据层（模型、数据源、仓库实现）
- `lib/domain`：领域层（实体、仓库接口）
- `lib/presentation`：表现层（BLoC、页面、组件）

模块导出策略：在每个功能目录下创建`index.dart`文件，统一导出公共API。

### TypeScript项目结构
后端TypeScript项目采用MVC模式组织：
- `src/controllers`：控制器
- `src/routes`：路由定义
- `src/middleware`：中间件
- `src/utils`：工具函数

前端管理后台采用功能模块化组织：
- `src/pages`：页面组件
- `src/services`：API服务
- `src/utils`：工具函数

**Section sources**
- [main.dart](file://flutter_app/lib/main.dart#L1-L105)
- [index.ts](file://backend/src/index.ts#L1-L85)
- [App.tsx](file://home/user/nian/admin-web/src/App.tsx#L1-L154)

## Dart静态分析规则

### analysis_options.yaml配置
项目使用`analysis_options.yaml`文件配置Dart静态分析规则：

```yaml
include: package:flutter_lints/flutter.yaml

linter:
  rules:
    # prefer_const_constructors: true
    # avoid_print: true
```

### 启用的Lint规则
项目继承`flutter_lints`推荐规则集，包含以下关键规则：
- **避免print语句**：`avoid_print`规则禁止在生产代码中使用print
- **优先使用const**：鼓励使用const构造函数优化性能
- **类型安全**：强制类型检查，避免隐式类型转换
- **代码可读性**：规范代码格式，提高可维护性

这些规则通过`flutter analyze`命令执行，帮助开发者在开发阶段发现潜在问题。

**Diagram sources**
- [analysis_options.yaml](file://flutter_app/analysis_options.yaml#L1-L29)

**Section sources**
- [analysis_options.yaml](file://flutter_app/analysis_options.yaml#L1-L29)
- [FLUTTER_DEVELOPMENT_GUIDE.md](file://FLUTTER_DEVELOPMENT_GUIDE.md#L209-L217)

## TypeScript编译选项解析

### 后端tsconfig.json配置
后端TypeScript项目配置了严格的编译选项：

```json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "moduleResolution": "node",
    "declaration": true,
    "sourceMap": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true
  }
}
```

### 关键选项说明
- **strict模式**：启用所有严格类型检查选项，提高代码安全性
- **esModuleInterop**：允许CommonJS和ES模块互操作，简化模块导入
- **target: ES2020**：目标JavaScript版本，支持现代语法特性
- **moduleResolution: node**：使用Node.js模块解析策略
- **strictNullChecks**：启用严格的空值检查，避免空指针异常
- **noUnusedLocals**：禁止未使用的局部变量，保持代码整洁

### 前端tsconfig.json配置
前端管理后台使用Vite构建，配置略有不同：
- **module: ESNext**：使用ES模块
- **moduleResolution: bundler**：使用打包器模块解析
- **jsx: react-jsx**：支持React JSX语法
- **isolatedModules: true**：确保每个文件可独立编译

**Diagram sources**
- [tsconfig.json](file://backend/tsconfig.json#L1-L27)
- [tsconfig.json](file://home/user/nian/admin-web/tsconfig.json#L1-L50)
- [tsconfig.node.json](file://home/user/nian/admin-web/tsconfig.node.json#L1-L20)

**Section sources**
- [tsconfig.json](file://backend/tsconfig.json#L1-L27)
- [tsconfig.json](file://home/user/nian/admin-web/tsconfig.json#L1-L50)
- [tsconfig.node.json](file://home/user/nian/admin-web/tsconfig.node.json#L1-L20)

## 前后端代码风格一致性

### 编辑器配置
建议使用`.editorconfig`文件统一编辑器设置：
- 缩进：2个空格
- 换行符：LF
- 字符编码：UTF-8
- 文件结尾：新行

### 提交前检查
项目应配置pre-commit钩子，执行以下检查：
- 运行`flutter analyze`检查Dart代码
- 运行`npm run lint`检查TypeScript代码
- 格式化代码确保风格统一

### 统一开发体验
通过共享配置文件和开发指南，确保团队成员拥有统一的开发体验。`FLUTTER_DEVELOPMENT_GUIDE.md`提供了详细的开发规范和最佳实践。

**Section sources**
- [FLUTTER_DEVELOPMENT_GUIDE.md](file://FLUTTER_DEVELOPMENT_GUIDE.md#L1-L242)
- [backend/package.json](file://backend/package.json#L1-L55)
- [home/user/nian/admin-web/package.json](file://home/user/nian/admin-web/package.json#L1-L65)

## 最佳实践与反模式

### Dart最佳实践
- **使用const构造函数**：提高性能，减少对象创建
- **BLoC模式**：分离业务逻辑与UI
- **Repository模式**：抽象数据源，提高可测试性
- **错误处理**：使用Failure模式处理应用级错误

### TypeScript最佳实践
- **严格类型检查**：充分利用TypeScript类型系统
- **模块化设计**：合理组织代码结构
- **错误处理**：统一错误处理中间件
- **API设计**：RESTful API设计规范

### 常见反模式规避
- 避免在Dart中使用print调试，应使用logger
- 避免在TypeScript中使用any类型，应使用具体类型
- 避免深层嵌套的Widget树，应提取为独立组件
- 避免在控制器中编写复杂业务逻辑，应分离到服务层

**Section sources**
- [FLUTTER_DEVELOPMENT_GUIDE.md](file://FLUTTER_DEVELOPMENT_GUIDE.md#L13-L242)
- [main.dart](file://flutter_app/lib/main.dart#L1-L105)
- [index.ts](file://backend/src/index.ts#L1-L85)
- [App.tsx](file://home/user/nian/admin-web/src/App.tsx#L1-L154)

## 结论
本编码规范文档系统地阐述了项目中TypeScript和Dart的统一编码标准。通过遵循这些规范，团队可以确保代码质量、提高可维护性、降低协作成本。建议所有开发者在开发过程中参考本规范，并通过静态分析工具持续验证代码质量。